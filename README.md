# gulp-shopify-critical

> Create critical css snippets for your Shopify theme.

## Installation
The node package and gulp task are inside of the workflow already, so there's nothing you need to do in that regard. However, the way that the critical task is triggered inside of the gulpfile is by the presence of a `critical` setting inside of `.config.json`.

## Usage
In your `.config.json` file, you'll need to add a `critical` property to the config object. The value of the property is an array of objects, with each object representing a page that you'd like to generate a critical stylesheet for. The object has two properties: 
  * `template` - the file name of the template you'd like to generate a critical stylesheet for minus the `.liquid` extension
  * `url` - the path of the url/page you'd like to use as the example page when generating the critical stylesheet. This will be the page that's crawled by the plugin to identify which selectors need to be included in the critical stylesheet. You don't need to include an object every single url that uses that specific template, just one object per template that includes an url of an page that uses that template.

```env
{
  "critical": [
    { "template": "index", "url": "/" },
    { "template": "product", "url": "/products/good-straight-jeans-blue-087" },
    { "template": "collection", "url": "/collections/skinny-jeans" },
    { "template": "page", "url": "/pages/about-us" },
    { "template": "page.special", "url": "/pages/special-page" }
  ]
}
```

Once you've got your `.config.json` setup with the templates you'd like to create critical stylesheets for, when you're running `gulp` and make a change to any of those templates, the `critical` task is run. The outcome of the task running is the creation of three files, `citical-head.liquid`, `critical.footer.liquid`, and `critical.[template].liquid` (where `[template]` is the name of the template the critical stylesheet was generated for).

Unlike other files that are generated by build tool, the location where the generated files are written to is inside the `dev/` directory, more specifically `dev/liquid/snippets`. One of the side effects of this is that when the `critical` task finishes, because files in the `dev/liquid/` directory are being changed, the `copy` task is triggered as well. This is by design and supposed to happen.

The last thing you'll need to do in order to get up and running with critical css is updating your `theme.liquid` file to reference the freshly created critical stylesheets. Fortunately, this is pretty easy to do with the `critical.head.liquid` and `critical.footer.liquid` files generated by the task. Simply replace the `<link>` tag loading `bvaccel.css` with an `{% include %}` tag loading `critical.head.liquid`, and towards the bottom of the page near the `</body>` tag, add another `{% include %}` tag loading `critical.footer.liquid`.

```liquid
<!-- Stylesheets ================================ -->
  <link rel="stylesheet" href="{{ 'bvaccel.css' | asset_url }}">
```
becomes...
```liquid
<!-- Stylesheets ================================ -->
  {% include 'critical.head' %}
```
also...
```liquid
<!-- Footer Stylesheets ================================ -->
  {% include 'critical.footer' %}
  
</body>
```

Know that every time you add or remove a template to the setting in `.config.json` and the `critical` task is run, a new version of `critical.head.liquid` and `critical.footer.liquid` is created, which includes references to all the critical stylesheets associated with the templates in the `critical` setting `.config.json`. In other words, every time you add or remove a template to the settings in `.config.json`, you don't have to worry about updating another file somewhere else.

## Notes

### Preview Themes
This plugin uses your preview theme as the location to grab your critical stylesheet selectors from. As such, if your preview theme is missing features the live production theme has that affect the height or width of the page, you might be generating a critical stylesheet that will cause problems when you deploy to production. As such, try your best to have your development theme match what's in the production theme.

### Triggering `critical` Task
Because the `critical` task is only triggered when you make a change to a template you're generating a critical stylesheet for, you may make a css change that significantly alters the height or width of the page and which selectors are or aren't included in the critical stylesheet. Be aware that you'll have to save the template(s) that are associated with those css changes in order to trigger the `critical` task again to generate a new critical stylesheet.

### Ignoring http://good-american.myshopify.com/?preview_theme_id=132273667 (403)

### Speed of Task

### Resulting Files (.liquid snippet vs. .css file)

### 

## Contribute

or don't. I don't care.

## Authors
[tshamz](https://github.com/tshamz)

## License
MIT
